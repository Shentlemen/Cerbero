<div class="demo-container">
  <app-notification-container></app-notification-container>
  <!-- Indicador de carga -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando stock...</span>
    </div>
    <p class="mt-2">Cargando datos del almacén...</p>
  </div>

  <div class="content-wrapper">
    <!-- Componente 3D -->
    <app-almacen-3d
      [almacenId]="'ALM02'"
      [estanteriaId]="'E1'"
      [niveles]="3"
      [cajasporNivel]="4"
      [stockData]="stockData3D"
      (cajaSeleccionada)="onCajaSeleccionada($event)">
    </app-almacen-3d>
  </div>

  <!-- Modal de detalle de caja -->
  <div *ngIf="mostrarModal" class="modal-overlay" (click)="cerrarModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>
          <i class="fas fa-box-open"></i>
          Estantería {{ cajaSeleccionada?.estanteria }} - Estante {{ cajaSeleccionada?.nivel }} - Sección {{ cajaSeleccionada?.seccion?.toUpperCase() }}
        </h3>
        <button class="close-btn" (click)="cerrarModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <div *ngIf="tieneContenido(); else sinContenido">
          <h4>Contenido de la caja:</h4>
          <div class="items-list">
            <div *ngFor="let item of cajaSeleccionada?.contenido || []" 
                 class="item-card"
                 [class.clickable]="!!item?.id"
                 (click)="item?.id && abrirModalCantidad(item)">
              <div class="item-info">
                <span class="item-nombre">{{ item.item?.nombreItem || item.nombre || 'Sin nombre' }}</span>
                <span class="item-cantidad">x{{ item.cantidad || 1 }}</span>
                <span *ngIf="item.numero" class="item-numero">{{ item.numero }}</span>
              </div>
              <span *ngIf="!item.id" class="item-hint">Equipo - gestionar en vista principal</span>
              <i *ngIf="item.id" class="fas fa-edit item-icon" title="Clic para modificar cantidad"></i>
            </div>
          </div>
        </div>
        
        <ng-template #sinContenido>
          <div class="empty-box">
            <i class="fas fa-box fa-3x"></i>
            <p>Esta caja está vacía</p>
          </div>
        </ng-template>
      </div>
      
      <div class="modal-footer">
        <button class="btn-agregar" (click)="agregarItem()">
          <i class="fas fa-plus"></i> Agregar Item
        </button>
        <button class="btn-cerrar" (click)="cerrarModal()">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>

