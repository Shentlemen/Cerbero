<div class="almacenes-container">
  <!-- Contenedor de notificaciones -->
  <app-notification-container></app-notification-container>
  
  <div class="header-section">
    <div class="title-wrapper">
      <h1 style="text-align: left; justify-content: flex-start;">
        <i class="fas fa-warehouse"></i> 
        Gestión de Almacenes
      </h1>
    </div>
  </div>

  <div class="almacenes-content">
    <!-- Header del contenido con botón de crear -->
    <div class="content-header">
      <!-- Botón para agregar nuevo almacén -->
      <div class="actions-section" *ngIf="canManageAlmacenes()">
        <button 
          class="btn btn-outline-secondary" 
          (click)="abrirModalAlmacen(modalAlmacen)">
          <i class="fas fa-plus"></i>
          Nuevo Almacén
        </button>
      </div>
    </div>

    <!-- Indicador de carga -->
    <div *ngIf="loading" class="text-center my-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p class="mt-2">Cargando almacenes...</p>
    </div>

    <!-- Mensaje de error -->
    <div *ngIf="error" class="alert alert-danger m-3">
      <i class="fas fa-exclamation-circle me-2"></i>
      {{ error }}
    </div>

          <!-- Cards de almacenes -->
      <div *ngIf="!loading && !error" class="cards-container">

      <!-- Grid de cards -->
      <div class="almacenes-grid">
        <div *ngFor="let almacen of almacenesFiltrados" class="almacen-card" 
             [class.clickable]="true">
          <div class="card-header">
            <div class="almacen-numero">
              <i class="fas fa-building"></i>
              <span>{{ almacen.numero }}</span>
            </div>
            <div class="card-actions" *ngIf="canManageAlmacenes()">
              <button 
                class="btn btn-warning btn-sm" 
                (click)="abrirModalAlmacen(modalAlmacen, almacen)"
                title="Editar almacén">
                <i class="fas fa-edit"></i>
              </button>
              <button 
                class="btn btn-danger btn-sm" 
                (click)="confirmarEliminacion(almacen)"
                title="Eliminar almacén">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </div>
          <div class="card-body" (click)="verStockAlmacen(almacen)">
            <div class="almacen-info">
              <div class="info-item">
                <i class="fas fa-warehouse text-primary"></i>
                <span>{{ almacen.nombre }}</span>
              </div>
              <div class="info-item" [ngClass]="{'no-stock': !tieneStock(almacen.id)}">
                <i class="fas" [ngClass]="tieneStock(almacen.id) ? 'fa-boxes text-success' : 'fa-box-open text-muted'"></i>
                <span *ngIf="tieneStock(almacen.id); else noStock">
                  {{ getStockDisponible(almacen.id) }} item(s) en stock
                </span>
                <ng-template #noStock>
                  <span>Sin stock disponible</span>
                </ng-template>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Mensaje cuando no hay almacenes -->
      <div *ngIf="almacenesFiltrados.length === 0" class="text-center p-5">
        <div class="empty-state">
          <i class="fas fa-warehouse fa-3x text-muted mb-3"></i>
          <h5 class="text-muted">No hay almacenes disponibles</h5>
          <p class="text-muted">
            Comienza creando tu primer almacén
          </p>
        </div>
      </div>
    </div>
    

  </div>
</div>

<!-- Diálogo de confirmación -->
<div *ngIf="showConfirmDialog" class="confirm-dialog-overlay">
  <div class="confirm-dialog">
    <div class="confirm-dialog-title">
      <i class="fas fa-exclamation-triangle"></i>
      Confirmar Eliminación
    </div>
    <div class="confirm-dialog-message">
      ¿Está seguro que desea eliminar este almacén? Esta acción no se puede deshacer.
    </div>
    <div class="confirm-dialog-buttons">
      <button class="confirm-dialog-button cancel" (click)="cancelarEliminacion()">
        Cancelar
      </button>
      <button class="confirm-dialog-button confirm" (click)="eliminarAlmacen()">
        Eliminar
      </button>
    </div>
  </div>
</div>

<!-- Modal para crear/editar almacén -->
<ng-template #modalAlmacen let-modal>
  <div class="modal-header">
    <h4 class="modal-title">
      <i class="fas fa-warehouse me-2"></i>
      {{ modoEdicion ? 'Editar' : 'Nuevo' }} Almacén
    </h4>
    <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="almacenForm" (ngSubmit)="guardarAlmacen()">
      <div class="mb-3">
        <label for="numero" class="form-label">Número *</label>
        <input 
          type="text" 
          class="form-control" 
          id="numero"
          formControlName="numero"
          placeholder="Ej: ALM001">
        <div *ngIf="almacenForm.get('numero')?.invalid && almacenForm.get('numero')?.touched" class="text-danger mt-1">
          <small *ngIf="almacenForm.get('numero')?.errors?.['required']">El número es requerido</small>
          <small *ngIf="almacenForm.get('numero')?.errors?.['maxlength']">El número no puede exceder 50 caracteres</small>
        </div>
      </div>
      
      <div class="mb-3">
        <label for="nombre" class="form-label">Nombre *</label>
        <input 
          type="text" 
          class="form-control" 
          id="nombre"
          formControlName="nombre"
          placeholder="Ej: Almacen 1 - Sexto Piso">
        <div *ngIf="almacenForm.get('nombre')?.invalid && almacenForm.get('nombre')?.touched" class="text-danger mt-1">
          <small *ngIf="almacenForm.get('nombre')?.errors?.['required']">El nombre es requerido</small>
          <small *ngIf="almacenForm.get('nombre')?.errors?.['maxlength']">El nombre no puede exceder 255 caracteres</small>
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">
      <i class="fas fa-times me-1"></i>
      Cancelar
    </button>
    <button 
      type="button" 
      class="btn btn-primary" 
      (click)="guardarAlmacen()"
      [disabled]="almacenForm.invalid">
      <i class="fas fa-save me-1"></i>
      {{ modoEdicion ? 'Actualizar' : 'Crear' }}
    </button>
  </div>
</ng-template>

<!-- Modal de confirmación para eliminar -->
<ng-template #modalConfirmacion let-modal>
  <div class="modal-header">
    <h4 class="modal-title text-danger">
      <i class="fas fa-exclamation-triangle me-2"></i>
      Confirmar Eliminación
    </h4>
    <button type="button" class="btn-close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <p>
      ¿Está seguro de que desea eliminar el almacén 
      <strong>"{{ almacenAEliminar?.numero }} - {{ almacenAEliminar?.nombre }}"</strong>?
    </p>
    <p class="text-warning">
      <i class="fas fa-warning me-1"></i>
      Esta acción no se puede deshacer.
    </p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">
      <i class="fas fa-times me-1"></i>
      Cancelar
    </button>
    <button type="button" class="btn btn-danger" (click)="eliminarAlmacen()">
      <i class="fas fa-trash me-1"></i>
      Eliminar
    </button>
  </div>
</ng-template> 