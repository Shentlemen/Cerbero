<div class="assets-container">
  <div class="header-section">
    <div class="title-wrapper">
      <h1>
        <i class="fas fa-laptop-code"></i> 
        Inventario de Activos
        <span *ngIf="route.snapshot.queryParams['softwareName']" class="filter-indicator">
          - Filtrado por software: {{ route.snapshot.queryParams['softwareName'] }}
        </span>
      </h1>
      
      <!-- Filtros por tipo de activo -->
      <div class="filters-container">
        <button 
          class="filter-btn" 
          [class.active]="currentFilter === ''"
          (click)="filterByType('')">
          <i class="fas fa-th-large"></i>
          <span>Todos</span>
          <span class="count">({{totalAssets}})</span>
        </button>
        
        <button 
          class="filter-btn" 
          [class.active]="currentFilter === 'DESKTOP'"
          [style.--device-color]="'#2e7d32'"
          [style.--device-bg-color]="'#e8f5e9'"
          [style.--device-border-color]="'#c8e6c9'"
          (click)="filterByType('DESKTOP')">
          <i class="fas fa-desktop" style="color: #2e7d32;"></i>
          <span>Desktops</span>
          <span class="count">({{pcCount}})</span>
        </button>
        
        <button 
          class="filter-btn" 
          [class.active]="currentFilter === 'MINI PC'"
          [style.--device-color]="'#f57c00'"
          [style.--device-bg-color]="'#fff3e0'"
          [style.--device-border-color]="'#ffe0b2'"
          (click)="filterByType('MINI PC')">
          <i class="fas fa-laptop" style="color: #f57c00;"></i>
          <span>Mini PCs</span>
          <span class="count">({{miniPcCount}})</span>
        </button>
        
        <button 
          class="filter-btn" 
          [class.active]="currentFilter === 'LAPTOP'"
          [style.--device-color]="'#1976d2'"
          [style.--device-bg-color]="'#e3f2fd'"
          [style.--device-border-color]="'#bbdefb'"
          (click)="filterByType('LAPTOP')">
          <i class="fas fa-laptop" style="color: #1976d2;"></i>
          <span>Laptops</span>
          <span class="count">({{laptopCount}})</span>
        </button>
        
        <button 
          class="filter-btn" 
          [class.active]="currentFilter === 'TOWER'"
          [style.--device-color]="'#34495e'"
          [style.--device-bg-color]="'#ecf0f1'"
          [style.--device-border-color]="'#bdc3c7'"
          (click)="filterByType('TOWER')">
          <i class="fas fa-server" style="color: #34495e;"></i>
          <span>Towers</span>
          <span class="count">({{towerCount}})</span>
        </button>
        
        <button 
          class="filter-btn" 
          [class.active]="currentFilter === 'LOW PROFILE DESKTOP'"
          [style.--device-color]="'#8e44ad'"
          [style.--device-bg-color]="'#f4e6f7'"
          [style.--device-border-color]="'#e8d5f0'"
          (click)="filterByType('LOW PROFILE DESKTOP')">
          <i class="fas fa-desktop" style="color: #8e44ad;"></i>
          <span>Low Profile</span>
          <span class="count">({{lowProfileCount}})</span>
        </button>
        
        <button 
          class="filter-btn" 
          [class.active]="currentFilter === 'MINI TOWER'"
          [style.--device-color]="'#e67e22'"
          [style.--device-bg-color]="'#fdf2e9'"
          [style.--device-border-color]="'#fad7b0'"
          (click)="filterByType('MINI TOWER')">
          <i class="fas fa-server" style="color: #e67e22;"></i>
          <span>Mini Tower</span>
          <span class="count">({{miniTowerCount}})</span>
        </button>
        
        <button 
          class="filter-btn" 
          [class.active]="currentFilter === 'DESCONOCIDO'"
          [style.--device-color]="'#95a5a6'"
          [style.--device-bg-color]="'#f8f9fa'"
          [style.--device-border-color]="'#dee2e6'"
          (click)="filterByType('DESCONOCIDO')">
          <i class="fas fa-question-circle" style="color: #95a5a6;"></i>
          <span>Desconocido</span>
          <span class="count">({{desconocidoCount}})</span>
        </button>
      </div>
    </div>
  </div>

  <div class="assets-content">
    <div class="table-container">
      <table class="assets-table">
        <thead>
          <tr>
            <th (click)="sortData('name')" [class.active]="sortColumn === 'name'">
              <div class="th-content">
                <span>Equipo</span>
                <i class="fas" [ngClass]="{
                  'fa-sort-up': sortColumn === 'name' && sortDirection === 'asc',
                  'fa-sort-down': sortColumn === 'name' && sortDirection === 'desc',
                  'fa-sort': sortColumn !== 'name'
                }"></i>
                <i class="fas fa-search search-icon" (click)="toggleFilter('name'); $event.stopPropagation()"></i>
                <div *ngIf="activeFilter === 'name'" class="filter-input-container" (click)="$event.stopPropagation()">
                  <input 
                    type="text" 
                    [value]="filterValues[activeFilter!]"
                    (input)="applyColumnFilter($event)"
                    (keyup)="handleKeyPress($event)"
                    placeholder="Buscar..."
                    class="filter-input"
                    autofocus>
                </div>
              </div>
            </th>
            <th (click)="sortData('osName')" [class.active]="sortColumn === 'osName'">
              <div class="th-content">
                <span>Sistema Operativo</span>
                <i class="fas" [ngClass]="{
                  'fa-sort-up': sortColumn === 'osName' && sortDirection === 'asc',
                  'fa-sort-down': sortColumn === 'osName' && sortDirection === 'desc',
                  'fa-sort': sortColumn !== 'osName'
                }"></i>
              </div>
            </th>
            <th (click)="sortData('ipAddr')" [class.active]="sortColumn === 'ipAddr'">
              <div class="th-content">
                <span>IP</span>
                <i class="fas" [ngClass]="{
                  'fa-sort-up': sortColumn === 'ipAddr' && sortDirection === 'asc',
                  'fa-sort-down': sortColumn === 'ipAddr' && sortDirection === 'desc',
                  'fa-sort': sortColumn !== 'ipAddr'
                }"></i>
                <i class="fas fa-search search-icon" (click)="toggleFilter('ipAddr'); $event.stopPropagation()"></i>
                <div *ngIf="activeFilter === 'ipAddr'" class="filter-input-container" (click)="$event.stopPropagation()">
                  <input 
                    type="text" 
                    [value]="filterValues[activeFilter!]"
                    (input)="applyColumnFilter($event)"
                    (keyup)="handleKeyPress($event)"
                    placeholder="Buscar..."
                    class="filter-input"
                    autofocus>
                </div>
              </div>
            </th>
            <th (click)="sortData('biosType')" [class.active]="sortColumn === 'biosType'">
              <div class="th-content">
                <span>Tipo</span>
                <i class="fas" [ngClass]="{
                  'fa-sort-up': sortColumn === 'biosType' && sortDirection === 'asc',
                  'fa-sort-down': sortColumn === 'biosType' && sortDirection === 'desc',
                  'fa-sort': sortColumn !== 'biosType'
                }"></i>
              </div>
            </th>
            <th>
              <div class="th-content">
                <span>Nro. Compra</span>
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let asset of pagedAssets" (click)="verDetallesAsset(asset)" class="asset-row">
            <td>
              <div class="asset-name">
                <i class="fas" [ngClass]="{
                  'fa-desktop': asset.biosType === 'DESKTOP' || asset.biosType === 'LOW PROFILE DESKTOP',
                  'fa-laptop': asset.biosType === 'LAPTOP' || asset.biosType === 'NOTEBOOK',
                  'fa-tablet-alt': asset.biosType === 'MINI PC',
                  'fa-server': asset.biosType === 'TOWER' || asset.biosType === 'MINI TOWER',
                  'fa-question-circle': asset.biosType === 'DESCONOCIDO' || !asset.biosType
                }"></i>
                <span>{{ asset.name }}</span>
              </div>
            </td>
            <td>
              <div class="os-badge" [ngClass]="{'windows': asset.osName?.includes('Windows'), 'linux': asset.osName?.includes('Linux')}">
                <i class="fab" [ngClass]="{'fa-windows': asset.osName?.includes('Windows'), 'fa-linux': asset.osName?.includes('Linux')}"></i>
                {{ asset.osName || 'Desconocido' }}
              </div>
            </td>
            <td>
              <span class="ip-address">{{ asset.ipAddr || 'No asignada' }}</span>
            </td>
            <td>
              <span class="type-badge" [ngClass]="{
                'desktop': asset.biosType === 'DESKTOP',
                'laptop': asset.biosType === 'LAPTOP' || asset.biosType === 'NOTEBOOK',
                'mini': asset.biosType === 'MINI PC',
                'tower': asset.biosType === 'TOWER',
                'low-profile': asset.biosType === 'LOW PROFILE DESKTOP',
                'mini-tower': asset.biosType === 'MINI TOWER',
                'desconocido': asset.biosType === 'DESCONOCIDO' || !asset.biosType
              }">
                {{ asset.biosType || 'Desconocido' }}
              </span>
            </td>
            <td>
              <span class="compra-link" (click)="verDetallesActivo(asset.name); $event.stopPropagation()">
                {{getNumeroCompra(asset.name)}}
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="pagination-container">
      <ngb-pagination
        [(page)]="page"
        [pageSize]="pageSize"
        [collectionSize]="collectionSize"
        [boundaryLinks]="true"
        [maxSize]="5"
        [rotate]="true"
        [ellipses]="false"
        class="custom-pagination">
      </ngb-pagination>
    </div>
  </div>
</div>
